import React, { useEffect, useState } from 'react'

export default function EmiCalculator({carPrice=500000}){
  const [principal,setPrincipal] = useState(Math.round(carPrice*0.8))
  const [down,setDown] = useState(Math.round(carPrice*0.2))
  const [months,setMonths] = useState(36)
  const [rate,setRate] = useState(9.5)
  useEffect(()=>{
    if(Number(principal)+Number(down)>carPrice){
      setDown(Math.max(0, carPrice-principal))
    }
  },[principal,down,carPrice])

  const loan = Math.max(0, Number(principal)-Number(down))
  const r = Number(rate)/(12*100)
  const N = Number(months) || 1
  let emi=0
  if(r===0) emi = loan/N
  else {
    emi = (loan * r * Math.pow(1+r,N))/(Math.pow(1+r,N)-1)
  }
  const totalInt = emi*N - loan

  return (
    <div className="mt-4 card p-4 rounded-xl">
      <h4 className="text-white font-semibold mb-3">EMI Calculator</h4>
      <div className="space-y-3 text-sm text-gray-300">
        <div>
          <div className="flex justify-between"><div>Loan Amount</div><div>₹{principal.toLocaleString()}</div></div>
          <input type="range" min="0" max={carPrice} value={principal} onChange={e=>setPrincipal(Number(e.target.value))} className="w-full"/>
        </div>
        <div>
          <div className="flex justify-between"><div>Down Payment</div><div>₹{down.toLocaleString()}</div></div>
          <input type="range" min="0" max={carPrice} value={down} onChange={e=>setDown(Number(e.target.value))} className="w-full"/>
        </div>
        <div className="grid grid-cols-2 gap-3">
          <div>
            <div className="flex justify-between"><div>Tenure (months)</div><div>{months}</div></div>
            <input type="range" min="6" max="120" value={months} onChange={e=>setMonths(Number(e.target.value))} className="w-full"/>
          </div>
          <div>
            <div className="flex justify-between"><div>Interest %</div><div>{rate}%</div></div>
            <input type="range" min="0" max="20" step="0.1" value={rate} onChange={e=>setRate(Number(e.target.value))} className="w-full"/>
          </div>
        </div>
        <div className="bg-white/6 p-3 rounded text-center">
          <div className="text-sm text-gray-300">Estimated Monthly EMI</div>
          <div className="text-2xl font-bold text-teal-300">₹{Math.round(emi).toLocaleString()}</div>
          <div className="text-xs text-gray-400 mt-1">Total Interest: ₹{Math.round(totalInt).toLocaleString()}</div>
        </div>
      </div>
    </div>
  )
}